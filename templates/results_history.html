<!doctype html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>AHP - L·ªãch s·ª≠ K·∫øt qu·∫£</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>L·ªãch s·ª≠ K·∫øt qu·∫£ ƒê√°nh gi√° AHP (L∆∞u tr·ªØ t·ª´ Database)</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
        </div>
        {% endif %}
    {% endwith %}

    {# Check the correct variable name passed from the route #}
    {% if history_list %}
        {# Iterate directly over the list (it's already sorted in Python) #}
        {% for history_item in history_list %}
            <div class="history-group">
                {# Access the timestamp string from the dictionary item #}
                <h3>K·∫øt qu·∫£ l√∫c: {{ history_item.timestamp_str }}</h3>
                <table class="excel-grid">
                    <thead>
                        <tr>
                            <th>X·∫øp h·∫°ng</th>
                            <th>Ng√†nh h·ªçc</th> {# Assuming 'phuong_an' means 'nganh hoc' in your context #}
                            <th>ƒêi·ªÉm t·ªïng h·ª£p</th>
                            <th>T·ªët nh·∫•t?</th>
                        </tr>
                    </thead>
                    <tbody>
                        {# Iterate over the 'results' list within the history_item #}
                        {% for row in history_item.results %} {# Entries are already sorted by score in SQL #}
                        <tr>
                            <td>{{ loop.index }}</td>
                            {# Access data using dictionary keys (because of DictCursor) #}
                            <td>{{ row.ten_phuong_an }}</td>
                            <td>{{ "%.4f"|format(row.diem_tong_hop) }}</td>
                            <td>{% if row.la_tot_nhat %}üèÜ C√≥{% else %}Kh√¥ng{% endif %}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endfor %}
    {% else %}
        <p>Ch∆∞a c√≥ l·ªãch s·ª≠ k·∫øt qu·∫£ n√†o ƒë∆∞·ª£c l∆∞u trong c∆° s·ªü d·ªØ li·ªáu.</p>
    {% endif %}


    <div class="button-container">
        <a href="{{ url_for('clear_session_and_start') }}" class="btn">‚Üê B·∫Øt ƒë·∫ßu ph√¢n t√≠ch m·ªõi</a>
    </div>
</body>
</html>